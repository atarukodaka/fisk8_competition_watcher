<hr>
<nav class="crumb">
  <ol class="breadcrumb">
    <li><a href="/">Home</a>
    <li><a href="/competitions">Competitions</a>
  </ol>
</nav>
<hr>
<!-- ================================================================ -->

<h1><%= competition[:name] %></h1>

<table class="table">
  <tr>
    <th>Location<td><%= competition[:city] %>, <%= competition[:country] %>
  </tr>
  <tr>
    <th>Date</th>
    <td><%= competition[:starting_date].strftime("%Y/%m/%d") %> -
      <%= competition[:ending_date].strftime("%Y/%m/%d") %>
    </td>
  </tr>
  <tr>
    <th>
      Official Site
    <td>
      <a href="<%= competition[:site_url] %>" target="_blank">Result</a>
  </tr>
</table>

<h2> Skating Order / Result</h2>

<table class="table table-striped table-hover">
<thead>
<tr>
  <th>Category<th>Entry<th>Segment1<th>Segment2<th>Result
</thead>
<% competition.categories.each {|category| %>
<tr>
  <td><%= category.name %>
  <td><a href="<%= category[:entry_url] %>">entry<a>
   <% segment = category.segments %>
  <td><a href="/result/<%= competition[:key]%>/<%= category.name %>/<%= segment.first.name %>"><%= segment.first.name %></a> (<a href="<%= segment.first.score_url %>">judge score</a>)
  <td><% if segment.second %>
         <a href="/result/<%= competition[:key]%>/<%= category.name %>/<%= segment.second.name %>"><%= segment.second.name %></a> (<a href="<%= segment.second.score_url %>">judge score</a>)
      <% end %>
  <td><a href="<%= category.result_url %>">result</a>
<% } %>
</table>

<h2>Time Schedule</h2>

<%
 ar = competition.categories.map {|category| 

  category.segments.map {|segment|
    {category: category.name, segment: segment.name, starting_time: segment.starting_time || Time.at(0)}
  }
 }.flatten

 first_date = Date.new(competition[:starting_date].year, competition[:starting_date].month, competition[:starting_date].day)

 classes = ['warning', 'danger', 'success', 'info']
%>

<table class="table table-hover">
  <tr>
    <th>Starting Time (<%= competition[:timezone] %>)<th>Tokyo/Asia (UTC<%= ActiveSupport::TimeZone.create("Asia/Tokyo").now.strftime("%z")[0..2] %>)<th>Content
  </tr>
  <% ar.sort_by {|item| item[:starting_time]}.each {|hash| %>
  <% dt = Date.new(hash[:starting_time].year, hash[:starting_time].month, hash[:starting_time].day) %>
  <tr class="<%= (classes[(dt - first_date) % classes.size]) %>">
    <% timezone = normalize_timezone(competition[:timezone] ) %>
    <% sto = stj = "" %>
    <% if hash[:starting_time].nil? || hash[:starting_time] == Time.at(0)
       else
         sto = hash[:starting_time].in_time_zone(timezone).strftime("%Y/%m/%d %H:%M")
         stj = hash[:starting_time].in_time_zone("Tokyo").strftime("%Y/%m/%d %H:%M")
       end %>
    <td><%= sto  %>
    <td><%= stj %>
    <td>

      <%
	 if (category = competition.categories.find_by_name(hash[:category])) && (segment = category.segments.find_by_name(hash[:segment])) && (!segment.skating_orders.empty?)
%>
<a href="/skating_order/<%= competition.key %>/<%= hash[:category] %>/<%= hash[:segment] %>"><%= hash[:category] %> - <%= hash[:segment] %></a>      
<% else %>
<%= hash[:category] %> - <%= hash[:segment] %>
<% end %>





  <% } %>
      
      
</table>
