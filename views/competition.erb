<h1><%= competition[:name] %></h1>

<table class="table">
  <tr>
    <th>Location<td><%= competition[:city] %>, <%= competition[:country] %>
  </tr>
  <tr>
    <th>Date</th>
    <td><%= competition[:starting_date].strftime("%Y/%m/%d") %> -
      <%= competition[:ending_date].strftime("%Y/%m/%d") %>
    </td>
  </tr>
  <tr>
    <th>
      Official Site
    <td>
      <a href="<%= competition[:site_url] %>" target="_blank">Result</a>
  </tr>
</table>

<h2> Skating Order / Result</h2>

<table class="table table-striped table-hover">
<thead>
<tr>
  <th>Category<th>Entry<th>Segment1<th>Segment2<th>Result
</thead>
<% competition.categories.each {|category| %>
<tr>
  <td><%= category.name %>
  <td><a href="<%= category[:entry_url] %>">entry<a>
   <% segment = category.segments %>
  <td><a href="<%= segment.first.order_url %>"><%= segment.first.try(:name) %></a> (<a href="<%= segment.first.score_url %>">judge score</a>)
  <td><a href="<%= segment.second.order_url %>"><%= segment.second.try(:name) %></a> (<a href="<%= segment.second.score_url %>">judge score</a>)
  <td><a href="<%= category.result_url %>">result</a>
<% } %>
</table>

<h2>Time Schedule</h2>

<%
 ar = competition.categories.map {|category| 

  category.segments.map {|segment|
    {category: category.name, segment: segment.name, starting_time: segment.starting_time || Time.at(0)}
  }
 }.flatten

%>

<table class="table table-striped table-hover">
  <tr>
    <th>Starting Time (<%= competition[:timezone] %>)<th>Tokyo/Asia (+9)<th>Content
  </tr>
  <% ar.sort_by {|item| item[:starting_time]}.each {|hash| %>
  <tr>
    <% timezone = competition[:timezone] 
       if (timezone.to_i != 0) 
         timezone = timezone.to_i
       end
     %>
    <% sto = stj = "" %>
    <% if hash[:starting_time].nil? 
       else
         sto = hash[:starting_time].in_time_zone(timezone).strftime("%Y/%m/%d %H:%M")
         stj = hash[:starting_time].in_time_zone("Tokyo").strftime("%Y/%m/%d %H:%M")
       end %>
    <td><%= sto  %>
    <td><%= stj %>
    <td><%= hash[:category] %>-<%= hash[:segment] %>

  <% } %>
      
      
</table>
