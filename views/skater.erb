

<% isu_number = params[:isu_number].to_i %>



<% skater = Skater.find_by(isu_number: isu_number) %>


<h1>Skater - <%=h skater.name %></h1>

<h2>Biography</h2>

<table class="table">
  <tr>
    <th>Name<td><%=h skater.name %>
  </tr>
  <tr>
    <th>Nation<td><%=h skater.nation %>
  </tr>
  <tr>
    <th>ISU Number<td><%= link_to(skater.isu_number, "http://www.isuresults.com/bios/isufs%08d.htm" % [skater.isu_number]) %>
  </tr>
  <tr>
    <th>Category<td><%=h skater.category %>
  </tr>
</table>

<h2>Competitions</h2>

<table class="table">
  <tr>
    <th>Season<th>Class<th>Competition<th>date<th>Ranking<th>Points<th>SP ranking<th>FS ranking<th>SP details<th>FS details
  </tr>
  <% CategoryResult.where(skater: skater).sort_by {|res| res.category.competition.starting_date}.reverse.each {|res| %>
  <tr>
    <td><%=h res.category.competition.season %>
    <td><%=h res.category.competition.competition_class %>
    <td><%= link_to(h(res.category.competition.name), "/competition/#{h res.category.competition.key}") %>
    <td><%=h res.category.competition.starting_date.strftime("%Y/%m/%d") %>
    <td><%=h res.ranking %>
    <td><%=h res.points %>
    <td><%=h res.sp_ranking %>
    <td><%=h res.fs_ranking %>

      <% segments = res.category.segments %>
      <% if !segments.first.nil? %>
    <td> <% seg_res = segments.first.segment_results.where(skater: skater).first %>
      <%=h seg_res.tss %> = <%=h seg_res.tes %> + <%=h seg_res.pcs %> - <%=h seg_res.deductions %>
      <% end %>

      <% if !segments.second.nil? %>
    <td> <% seg_res = segments.second.segment_results.where(skater: skater).first %>
      <%=h seg_res.tss %> = <%=h seg_res.tes %> + <%=h seg_res.pcs %> - <%=h seg_res.deductions %>
      <% end %>
  <% } %>
</table>


